from django.db import migrations


def seed_questions_with_option_ids(apps, schema_editor):
    Question = apps.get_model('core', 'Question')
    QuestionOption = apps.get_model('core', 'QuestionOption')

    # Same questions as 0005_seed_all_questions, but each option now has an explicit per-question id
    QUESTIONS = [
        {
            "id": 1,
            "question": "С чем вы связываете появление ушного шума?",
            "type": "multiple",
            "options": [
                {"id": 1, "label": "акустическая травма"},
                {"id": 2, "label": "механическая травма"},
                {"id": 3, "label": "стресс"},
                {"id": 4, "label": "переутомление"},
                {"id": 5, "label": "прием препаратов (укажите каких в следующем окне)"},
                {"id": 6, "label": "заболевание уха (укажите какие в следующем окне)"},
                {"id": 7, "label": "общие заболевания (укажите какие в следующем окне)"},
                {"id": 8, "label": "другое (укажите в следующем окне)"}
            ],
            "input": "Добавьте информацию, связанную с появлением ушного шума, если это необходимо:"
        },
        {
            "id": 2,
            "question": "Ушной шум ощущается:",
            "type": "single",
            "options": [
                {"id": 1, "label": "всегда в правом ухе"},
                {"id": 2, "label": "всегда в левом ухе"},
                {"id": 3, "label": "то справа, то слева"},
                {"id": 4, "label": "в обоих ушах"},
                {"id": 5, "label": "в голове"}
            ]
        },
        {
            "id": 3,
            "question": "Постарайтесь описать, какой внешний звук напоминает ушной шум (например, шум моря, писк комара, и т.д.):",
            "type": "input",
            "input": ""
        },
        {
            "id": 4,
            "question": "Ушной шум ощущается:",
            "type": "single",
            "options": [
                {"id": 1, "label": "ежедневно в течение всего дня"},
                {"id": 2, "label": "ежедневно, но не целый день"},
                {"id": 3, "label": "не каждый день"}
            ],
        },
        {
            "id": 5,
            "question": "Ушной шум ощущается:",
            "type": "single",
            "options": [
                {"id": 1, "label": "только в тишине"},
                {"id": 2, "label": "и в тишине, и в шуме (при разговоре)"}
            ],
        },
        {
            "id": 6,
            "question": "Характер шума",
            "type": "single",
            "options": [
                {"id": 1, "label": "постоянный"},
                {"id": 2, "label": "пульсирующий"},
                {"id": 3, "label": "прерывистый"}
            ],
        },
        {
            "id": 7,
            "question": "Какие факторы усиливают или вызывают появление шума?",
            "type": "multiple",
            "options": [
                {"id": 1, "label": "эмоциональный стресс"},
                {"id": 2, "label": "физическая нагрузка"},
                {"id": 3, "label": "переутомление, дефицит сна"},
                {"id": 4, "label": "прием алкоголя"},
                {"id": 5, "label": "нахождение в тишине"},
                {"id": 6, "label": "определенное время суток"},
                {"id": 7, "label": "фазы менструального цикла"},
                {"id": 8, "label": "обострения хронических заболеваний (укажите каких далее)"},
                {"id": 9, "label": "другое (укажите далее)"}
            ],
            "input": "Добавьте информацию, связанную с факторами, влияющими на ушной шум, если это необходимо:"
        },
        {
            "id": 8,
            "question": "Что приводит к ослаблению/исчезновению шума?",
            "type": "multiple",
            "options": [
                {"id": 1, "label": "прослушивание музыки, нахождение в шуме"},
                {"id": 2, "label": "прием алкоголя"},
                {"id": 3, "label": "отдых, пребывание на природе, сон"},
                {"id": 4, "label": "прием препаратов (указать каких далее)"},
                {"id": 5, "label": "другое (указать далее)"}
            ],
            "input": "Добавьте информацию о том, что влияет на ушной шум, если это необходимо:"
        },
        {
            "id": 9,
            "question": "К каким негативным эффектам приводит ушной шум?",
            "type": "multiple",
            "options": [
                {"id": 1, "label": "нарушение сна"},
                {"id": 2, "label": "тревога"},
                {"id": 3, "label": "подавленное настроение, депрессия"},
                {"id": 4, "label": "снижение концентрации внимания"},
                {"id": 5, "label": "страх"},
                {"id": 6, "label": "возбуждение"},
                {"id": 7, "label": "другое (указать далее)"}
            ],
            "input": "Добавьте информацию о том, как на вас влияет ушной шум, если это необходимо:"
        },
        {
            "id": 10,
            "question": "Обращались ли вы за психологической или психотерапевтической помощью?",
            "type": "single",
            "options": [
                {"id": 1, "label": "Да"},
                {"id": 2, "label": "Нет"}
            ]
        },
        {
            "id": 11,
            "question": "Готовы ли вы регулярно обращаться за помощью психолога или психотерапевта в формате очных консультаций для лечения ушного шума?",
            "type": "single",
            "options": [
                {"id": 1, "label": "Да"},
                {"id": 2, "label": "Нет"}
            ]
        },
        {
            "id": 12,
            "question": "Готовы ли вы самостоятельно выполнять упражнения для снижения проявлений ушного шума на ре��улярной основе в домашних условиях?",
            "type": "single",
            "options": [
                {"id": 1, "label": "Да"},
                {"id": 2, "label": "Нет"}
            ]
        },
        # Раздел с оценкой тревожности (15-21)
        {
            "id": 15,
            "question": "Я испытываю напряжение, мне не по себе",
            "type": "single",
            "options": [
                {"id": 1, "label": "все время (3)"},
                {"id": 2, "label": "часто (2)"},
                {"id": 3, "label": "время от времени, иногда (1)"},
                {"id": 4, "label": "совсем не испытываю (0)"}
            ]
        },
        {
            "id": 16,
            "question": "Я испытываю страх, кажется, что что-то ужасное вот-вот случиться",
            "type": "single",
            "options": [
                {"id": 1, "label": "опредленно, это так, и страх очень велик (3)"},
                {"id": 2, "label": "да, это так, но страх не очень велик (2)"},
                {"id": 3, "label": "иногда, но это меня не беспокоит (1)"},
                {"id": 4, "label": "совсем не испытываю (0)"}
            ]
        },
        {
            "id": 17,
            "question": "Беспокойные мысли крутятся у меня в голове",
            "type": "single",
            "options": [
                {"id": 1, "label": "постоянно (3)"},
                {"id": 2, "label": "большую часть времени (2)"},
                {"id": 3, "label": "время от времени и не так часто (1)"},
                {"id": 4, "label": "только иногда (0)"}
            ]
        },
        {
            "id": 18,
            "question": "Я легко могу присесть и расслабиться",
            "type": "single",
            "options": [
                {"id": 1, "label": "опредленно, это так (0)"},
                {"id": 2, "label": "наверное, это так (1)"},
                {"id": 3, "label": "лишь изредка, это так (2)"},
                {"id": 4, "label": "совсем не могу (3)"}
            ]
        },
        {
            "id": 19,
            "question": "Я испытываю внутреннее напряжение или дрожь",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем не испытываю (0)"},
                {"id": 2, "label": "иногда (1)"},
                {"id": 3, "label": "часто (2)"},
                {"id": 4, "label": "очень часто (3)"}
            ]
        },
        {
            "id": 20,
            "question": "Я испытываю неусидчивость, мне постоянно нужно двигаться",
            "type": "single",
            "options": [
                {"id": 1, "label": "определенно, это так (3)"},
                {"id": 2, "label": "наверное, это так (2)"},
                {"id": 3, "label": "лишь в некоторой степени, это так (1)"},
                {"id": 4, "label": "совсем не испытываю (0)"}
            ]
        },
        {
            "id": 21,
            "question": "У меня бывает внезапное чувство паники",
            "type": "single",
            "options": [
                {"id": 1, "label": "очень часто (3)"},
                {"id": 2, "label": "довольно часто (2)"},
                {"id": 3, "label": "не так уж и часто (1)"},
                {"id": 4, "label": "совсем не бывает (0)"}
            ]
        },
        # Раздел с оценкой депрессии/анедонии (22-28)
        {
            "id": 22,
            "question": "То, что приносило мне большое удовольствие, и сейчас вызывает у меня такое же чувство",
            "type": "single",
            "options": [
                {"id": 1, "label": "определенно, это так (0)"},
                {"id": 2, "label": "наверное, это так (1)"},
                {"id": 3, "label": "лишь в очень малой степени, это так (2)"},
                {"id": 4, "label": "это совсем не так (3)"}
            ]
        },
        {
            "id": 23,
            "question": "Я способен рассмеяться и увидеть в том или ином событии смешное",
            "type": "single",
            "options": [
                {"id": 1, "label": "определенно, это так (0)"},
                {"id": 2, "label": "наверное, это так (1)"},
                {"id": 3, "label": "лишь в очень малой степени, это так (2)"},
                {"id": 4, "label": "это совсем не так (3)"}
            ]
        },
        {
            "id": 24,
            "question": "Я испытываю бодрость",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем не испытываю (3)"},
                {"id": 2, "label": "очень редко (2)"},
                {"id": 3, "label": "иногда (1)"},
                {"id": 4, "label": "практически все время (0)"}
            ]
        },
        {
            "id": 25,
            "question": "Мне кажется, что я стал все делать очень медленно",
            "type": "single",
            "options": [
                {"id": 1, "label": "практически все время (3)"},
                {"id": 2, "label": "часто (2)"},
                {"id": 3, "label": "иногда (1)"},
                {"id": 4, "label": "совсем нет (0)"}
            ]
        },
        {
            "id": 26,
            "question": "Я не слежу за своей внешностью",
            "type": "single",
            "options": [
                {"id": 1, "label": "определенно, это так (3)"},
                {"id": 2, "label": "я не уделяю этому столько времени, сколько нужно (2)"},
                {"id": 3, "label": "может быть, я стал меньше уделять этому времени (1)"},
                {"id": 4, "label": "я слежу за собой так же, как и раньше (0)"}
            ]
        },
        {
            "id": 27,
            "question": "Я считаю, что мои дела (занятия, увлечения) могут принести мне чувство удовлетворения",
            "type": "single",
            "options": [
                {"id": 1, "label": "точно так же, как и обычно (0)"},
                {"id": 2, "label": "да, но не в той степени, как раньше (1)"},
                {"id": 3, "label": "значительно меньше, чем обычно (2)"},
                {"id": 4, "label": "совсем так не считаю (3)"}
            ]
        },
        {
            "id": 28,
            "question": "Я могу получать удовольствие от хорошей книги, радио - или телепрограммы",
            "type": "single",
            "options": [
                {"id": 1, "label": "часто (0)"},
                {"id": 2, "label": "иногда (1)"},
                {"id": 3, "label": "редко (2)"},
                {"id": 4, "label": "очень редко (3)"}
            ]
        },
        # Новый блок вопросов о восприятии шума (29-41)
        {
            "id": 29,
            "question": "Я боюсь того, что шум в ушах никогда не пройдет",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        },
        {
            "id": 30,
            "question": "Я чувствую, что больше не могу его терпеть",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        },
        {
            "id": 31,
            "question": "Я думаю, что мне никогда не станет лучше",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        },
        {
            "id": 32,
            "question": "Я испытываю отчаяние из-за шума в ушах и чувствую, как оно переполняет меня",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        },
        {
            "id": 33,
            "question": "Я больше не могу выносить шум в ушах",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        },
        {
            "id": 34,
            "question": "Я боюсь, что шум в ушах станет еще сильнее",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        },
        {
            "id": 35,
            "question": "Я часто вспоминаю ситуации, когда шум в ушах был сильнее, чем сейчас, и боюсь, что это снова повторится",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        },
        {
            "id": 36,
            "question": "Я очень сильно хочу, чтобы шум в ушах полностью прошел",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        },
        {
            "id": 37,
            "question": "Я не могу перестать о нем думать",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        },
        {
            "id": 38,
            "question": "Я постоянно думаю о том, насколько сильно у меня шумит в ушах",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        },
        {
            "id": 39,
            "question": "Я постоянно думаю о том, как сильно я хочу, чтобы шум в ушах прекратился",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        },
        {
            "id": 40,
            "question": "Я ничего не могу сделать для того, чтобы шум в ушах уменьшился",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        },
        {
            "id": 41,
            "question": "Я думаю о том, может ли случится что-нибудь плохое",
            "type": "single",
            "options": [
                {"id": 1, "label": "совсем нет (0)"},
                {"id": 2, "label": "немного (1)"},
                {"id": 3, "label": "умеренно (2)"},
                {"id": 4, "label": "значительно (3)"},
                {"id": 5, "label": "всегда (4)"}
            ]
        }
    ]

    for q in QUESTIONS:
        question, _ = Question.objects.update_or_create(
            id=q.get('id'),
            defaults={
                'text': q['question'],
                'type': q['type'],
                'input_text': q.get('input')
            }
        )
        # Replace options to ensure consistency and stable order
        question.options.all().delete()
        for idx, opt in enumerate(q.get('options', [])):
            # We intentionally ignore opt['id'] for DB PK to avoid conflicts; it's per-question only.
            QuestionOption.objects.create(
                question=question,
                label=opt['label'],
                order=idx
            )


def unseed_questions_with_option_ids(apps, schema_editor):
    Question = apps.get_model('core', 'Question')
    # Delete only our seeded questions by IDs 1..41, matching the range used above
    Question.objects.filter(id__in=list(range(1, 42))).delete()


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0006_participant_visit_fields'),
    ]

    operations = [
        migrations.RunPython(seed_questions_with_option_ids, reverse_code=unseed_questions_with_option_ids),
    ]
